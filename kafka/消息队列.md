#### 什么是消息队列？
消息队列是分布式系统中重要的组件。
- 主要解决应用耦合，异步消息，流量削峰。
- 可实现高性能，高可用，可伸缩和最终一致性架构，是大型分布式系统不可缺少的中间件。

#### 消息队列有哪些角色？
- 生产者：负责生产消息
- 消费者：负责消费消息
- 消息代理：负责存储消息和转发消息两件事情。其中，转发消息分为推送和拉取两种方式。
  - 拉取：是指 Consumer 主动从 Message Broker 获取消息
  - 推送：是指 Message Broker 主动将 Consumer 感兴趣的消息推送给 Consumer 。

#### 消息队列有哪些使用场景？
- 应用解耦
- 异步处理
- 流量削峰
- 消息通讯 可以不太关心
- 日志处理

#### 消息队列有什么优缺点
缺点：
1. 系统可用性降低，因为加入了新的组件。
2. 系统复杂度高，加入了新的组件
3. 一致性问题。

#### 消息队列有几种消费语义？
一共有3种，分别如下：
1. 消息至多被消费一次：消息可能会丢失，但绝不重复。
2. 消息至少被消费一次：消息可以重传，但绝不丢失。
3. 消息仅被消费一次：每一条消息只被传递一次。

#### 消息队列有几种投递方式？分别有什么优缺点？
一种push和一种pull
- push
  - 优点，就是及时性
  - 缺点，就是受限于消费者的消费能力，可能造成消息的堆积，Broker会不断给消费者发送不能处理的消息
- pull
  - 优点，就是主动权掌握在消费方，可以根据自己的消息速度进行消息拉取。
  - 缺点，就是消费方不知道什么时候可以获取的最新的消息，会有消息延迟和忙等。

目前的消息队列，基于push+pull模式结合的方式，Broker仅仅告诉Consumer有新的消息，具体的消息拉取，还是Consumer自己主动拉取。

#### 如何保证消费者的消费消息的幂等性？
如果要达到消费者的消费消息的幂等性，就需要消息仅被消费一次，且每条消息从 Producer 保证被送达，并且被 Consumer 仅消费一次。

对于producer 来说：
可能因为网络原因，Producer 重试多次发送消息，实际第一次就发送成功，那么就会产生多条相同的消息。   
对于Consumer 来说：  
可能因为Broker 的消息进度丢失，导致消息重复投递Consumer  
Consumer 消费成功，但是因为JVM异常崩溃，导致消费的进度未及时同步给Consumer  

##### 如何解决？
消费者实现幂等性，有两种方式：
1. 框架层统一封装
2. 业务层自己实现

**框架层统一封装**
首先，需要有一个消息排重的唯一标识，该编号只能由 Producer 生成，例如说使用 uuid、或者其它唯一编号的算法 。

**业务自己实现**
